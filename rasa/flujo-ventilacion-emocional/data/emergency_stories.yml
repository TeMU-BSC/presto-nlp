version: "2.0"

stories:

  #- story: emergency with alert + más preguntas
    #steps: 
    #- intent: alert
    #- action: utter_alert
    #- intent: emergency
    #- action: utter_confirm_emergency
    #- intent: alert_detected
    #- action: utter_alert_detected
#    - action: utter_alert_detected_selector
#    - intent: mas_preguntas
#    - action: utter_mas_preguntas

  - story: emergency with alert + contar
    steps: 
    - intent: alert
    - action: utter_alert
    - intent: emergency
    - action: utter_confirm_emergency
    - intent: alert_detected
    - action: utter_alert_detected
 #   - action: utter_alert_detected_selector
    - intent: retrieval_alert_intent
    - action: utter_si_contar
  #  - action: action_restart
  #!!!  - action: action_listen
    
  - story: emergency with no_alert + contar
    steps: 
    - intent: alert
    - action: utter_alert
    - intent: emergency
    - action: utter_confirm_emergency
    - intent: no_alert_detected
    - action: utter_alert_detected
 #   - action: utter_alert_detected_selector
    - intent: retrieval_alert_intent
    - action: utter_si_contar
  #  - action: action_restart
  #!!!  - action: action_listen
    
  - story: emergency_false_alarm # ok revisado
    steps:
    - intent: alert
    - action: utter_alert
    - intent: noemergency
    - action: utter_noemergency
  #  - action: action_restart
  #  - action: action_listen #cambiar nombre y poner noemergency. Se queda hasta que decidan flujo final para ambos

  - story: gender_violence_ denyfirstquestion #ok revisado
    steps:
    - intent: genderViolence
    - action: utter_start_genderViolence #selector con deny y emergency
    - intent: noemergency
    - action: utter_noemergency
  #  - action: action_restart
  #  - action: action_listen

  - story: gender_violence_ direct #ok revisado
    steps:
    - intent: genderViolence
    - action: utter_start_genderViolence #selector con deny y emergency
    - intent: confirmgv
    - action: utter_ask_genderViolence
    - intent: confirmgv2 
    - action: utter_ask_2_genderViolence #revisar   ## Añadir mas
    - intent: confirmgv3
    - action: utter_call_to_emergency_gv # o recursos o contar
 #   - action: utter_retrieval
 
  - story: gender_violence_ direct #ok revisado
    steps:
    - intent: genderViolence
    - action: utter_start_genderViolence #selector con deny y emergency
    - intent: confirmgv
    - action: utter_ask_genderViolence
    - intent: no_confirmgv2 
    - action: utter_ask_2_genderViolence #revisar   ## Añadir mas
    - intent: confirmgv3
    - action: utter_call_to_emergency_gv # o recursos o contar
 #   - action: utter_retrieval
    
  - story: gender_violence_ direct #ok revisado
    steps:
    - intent: genderViolence
    - action: utter_start_genderViolence #selector con deny y emergency
    - intent: confirmgv
    - action: utter_ask_genderViolence
    - intent: confirmgv2 #revisar
    - action: utter_ask_2_genderViolence #revisar   ## Añadir mas
    - intent: confirmgv3
    - action: utter_call_to_emergency_gv # o recursos o contar
    - intent: confirm_retrieval         # contar
    - action: utter_si_contar           # dime
    
  - story: gender_violence_ direct #ok revisado
    steps:
    - intent: genderViolence
    - action: utter_start_genderViolence #selector con deny y emergency
    - intent: confirmgv
    - action: utter_ask_genderViolence
    - intent: no_confirmgv2 #revisar
    - action: utter_ask_2_genderViolence #revisar   ## Añadir mas
    - intent: confirmgv3
    - action: utter_call_to_emergency_gv # o recursos o contar
    - intent: confirm_retrieval         # contar
    - action: utter_si_contar           # dime
    
  - story: gender_violence_ direct ultima no #ok revisado
    steps:
    - intent: genderViolence
    - action: utter_start_genderViolence #selector con deny y emergency
    - intent: confirmgv
    - action: utter_ask_genderViolence
    - intent: confirmgv2 #revisar
    - action: utter_ask_2_genderViolence #revisar   ## Añadir mas
    - intent: denygv
    - action: utter_answer_no_genderViolence
    - action: utter_call_to_emergency_gv_denylastcuestion
  #  - action: utter_retrieval
    #- action: utter_answer_no_genderViolence
    #- action: utter_call_to_emergency_gv_denylastcuestion
    #- action: utter_keep_talking
    
  - story: gender_violence_ direct ultima no #ok revisado
    steps:
    - intent: genderViolence
    - action: utter_start_genderViolence #selector con deny y emergency
    - intent: confirmgv
    - action: utter_ask_genderViolence
    - intent: no_confirmgv2 #revisar
    - action: utter_ask_2_genderViolence #revisar   ## Añadir mas
    - intent: denygv
    - action: utter_answer_no_genderViolence
    - action: utter_call_to_emergency_gv_denylastcuestion
 #   - action: utter_retrieval
    #- action: utter_answer_no_genderViolence
    #- action: utter_call_to_emergency_gv_denylastcuestion
    #- action: utter_keep_talking


  #- story: retrieval_intent
    #steps:
      #- intent: retrieval_alert_intent
      #- action: utter_retrieval

  # # - story: emergency # ok revisado
  # #   steps:
  # #   - intent: alert
  # #   - action: utter_alert # selector con deny y emergency
  # #   - intent: emergency
  # #   - action: utter_confirm_emergency
  # #   - intent: emergency
  # #   - action: utter_emergency
  
  # - story: emergency with alert /alert_detected
  #   steps: 
  #   - intent: alert
  #   - action: utter_alert
  #   - intent: emergency
  #   - action: utter_confirm_emergency
  #   - intent: alert_detected
  #   - action: utter_alert_detected
  #   - action: utter_alert_detected_selector



  # # - story: emergency # ok revisado
  # #   steps:
  # #   - intent: alert
  # #   - action: utter_alert # selector con deny y emergency
  # #   - intent: confirm
  # #   - action: utter_confirm_emergency
  # #   - intent: emergency
  # #   - action: utter_emergency
  # #   - intent: emergency
  # #   - action: utter_call_to_emergency

  # - story: emergency_false_alarm # ok revisado
  #   steps:
  #   - intent: alert
  #   - action: utter_alert
  #   - intent: inform_sentiment
  #   - action: utter_sentiment_NEG #cambiar nombre y poner noemergency. Se queda hasta que decidan flujo final para ambos



  # - story: gender_violence_ denyfirstquestion #ok revisado
  #   steps:
  #   - intent: genderViolence
  #   - action: utter_start_genderViolence #selector con deny y emergency
  #   - intent: inform_sentiment
  #   - action: utter_sentiment_NEG


  # - story: gender_violence_ direct #ok revisado
  #   steps:
  #   - intent: genderViolence
  #   - action: utter_start_genderViolence #selector con deny y emergency
  #   - intent: confirmgv
  #   - action: utter_ask_genderViolence
  #   - intent: confirmgv2 #revisar
  #   - action: utter_ask_2_genderViolence #revisar   ## Añadir mas
  #   - intent: confirmgv3
  #   - action: utter_call_to_emergency_gv


  # - story: gender_violence_ direct ultima no #ok revisado
  #   steps:
  #   - intent: genderViolence
  #   - action: utter_start_genderViolence #selector con deny y emergency
  #   - intent: confirmgv
  #   - action: utter_ask_genderViolence
  #   - intent: confirmgv2 #revisar
  #   - action: utter_ask_2_genderViolence #revisar   ## Añadir mas
  #   - intent: confirmgv3
  #   - action: utter_call_to_emergency_gv



  # - story: gender_violence_ direct ultima no #ok revisado
  #   steps:
  #   - intent: genderViolence
  #   - action: utter_start_genderViolence #selector con deny y emergency
  #   - intent: confirmgv
  #   - action: utter_ask_genderViolence
  #   - intent: confirmgv2 #revisar
  #   - action: utter_ask_2_genderViolence #revisar   ## Añadir mas
  #   - intent: deny
  #   - action: utter_answer_no_genderViolence
  #   - action: utter_call_to_emergency_gv_denylastcuestion

  
#### mixed stories

## pos

## seguir conversación POS      
 
  - story: seguir conversación + Emotion 3 x POS contar
    steps:
      - or:
        - intent: retrieval_alert_intent
        - intent: confirm_retrieval              # contar más
      - action: utter_si_contar             # soy todo oídos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS         # fantastico!
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS2         # fantastico!
      - action: utter_ask_tell_more_POS     # quieres contarme algo mas? (selector)
      - intent: confirm                     # sí o directamente 
      - action: utter_si_contar             # soy todo oidos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_selector_POS_last     # quieres contarme algo mas o aprender emociones positivas?

  - story: seguir conversación POS + Emotion 3 x POS deny 
    steps:
      - or:
        - intent: retrieval_alert_intent
        - intent: confirm_retrieval              # contar más
      - action: utter_si_contar             # soy todo oídos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado # rasa 3 con la condicion slot = pos y ya sino lista de intents + pos
      - slot_was_set:
        - sentiment: POS                    # positivo
      - action: utter_sentiment_POS         # fantastico!
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
        - sentiment: POS                  # positivo
      - action: utter_sentiment_POS2         # fantastico!
      - action: utter_ask_tell_more_POS      # quieres contarme algo mas? (selector)
      - intent: deny                         # no
      - action: utter_no_contar 
      - action: utter_selector_POS_last      # quieres contarme algo mas o aprender emociones positivas?
    
### variaciones POS / NEU
  - story: seguir conversación POS + Emotion POS - POS - NEU contar
    steps:
      - or:
        - intent: retrieval_alert_intent
        - intent: confirm_retrieval              # contar más
      - action: utter_si_contar             # soy todo oídos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS         # fantastico!
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS2         # fantastico!
      - action: utter_ask_tell_more_POS     # quieres contarme algo mas? (selector)
      - intent: confirm                     # sí o directamente 
      - action: utter_si_contar             # soy todo oidos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado
      - slot_was_set:
          - sentiment: NEU                  # neutro
      - action: utter_selector_POS_last     # quieres contarme algo mas o aprender emociones positivas?

     
  - story: seguir conversación POS + Emotion POS - NEU - POS contar
    steps:
      - or:
        - intent: retrieval_alert_intent
        - intent: confirm_retrieval              # contar más
      - action: utter_si_contar             # soy todo oídos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS         # fantastico!
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: NEU                  # neutro
      - action: utter_sentiment_NEU         # de acuerdo, me cuentas más?
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_selector_POS_last     # quieres contarme algo mas o aprender emociones positivas?      
      
## seguir conversación NEG
  - story: seguir conversación NEG + 3 x NEG contar
    steps:
      - or:
        - intent: retrieval_alert_intent
        - intent: confirm_retrieval              # contar más
      - action: utter_si_contar             # soy todo oídos
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment       
      - slot_was_set:
          - sentiment: NEG                  # mal
      - action: utter_sentiment_NEG         # lo siento, cuéntame más
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_contar       # lo siento. quieres contarme más?
      - intent: confirmcontar               # sí 
      - action: utter_si_contar             # soy todo oídos
      - or:
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_NEG_last     # contar más o feedback emoción negativa?
      # - checkpoint: user_give_emotion_NEG

  - story: seguir conversación NEG + 3 x NEG deny
    steps:
      - or:
        - intent: retrieval_alert_intent
        - intent: confirm_retrieval              # contar más
      - action: utter_si_contar             # soy todo oídos
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment         
      - slot_was_set:
          - sentiment: NEG                  # mal
      - action: utter_sentiment_NEG         # lo siento, cuéntame más
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_contar       # lo siento. quieres contarme más?
      - intent: denyContar                  # no
      - action: utter_no_contar             # no pasa nada
      - action: utter_selector_NEG_last    # contar más o feedback emoción negativa?

## variaciones NEG / NEU

  - story: seguir conversación NEG + NEG - NEG - NEU contar
    steps:
      - or:
        - intent: retrieval_alert_intent
        - intent: confirm_retrieval              # contar más
      - action: utter_si_contar             # soy todo oídos
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment       
      - slot_was_set:
          - sentiment: NEG                  # mal
      - action: utter_sentiment_NEG         # lo siento, cuéntame más
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_contar       # lo siento. quieres contarme más?
      - intent: confirmcontar               # sí 
      - action: utter_si_contar             # soy todo oídos
      - or:
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEU                    # estoy mal
      - action: utter_selector_NEG_last     # contar más o feedback emoción negativa?
      # - checkpoint: user_give_emotion_NEG
      
  - story: seguir conversación NEG + NEG - NEU - NEG contar
    steps:
      - or:
        - intent: retrieval_alert_intent
        - intent: confirm_retrieval              # contar más
      - action: utter_si_contar             # soy todo oídos
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment       
      - slot_was_set:
          - sentiment: NEG                  # mal
      - action: utter_sentiment_NEG         # lo siento, cuéntame más
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEU                    # estoy mal
      - action: utter_sentiment_NEU         # soy todo oídos
      - or:
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_NEG_last     # contar más o feedback emoción negativa?
      # - checkpoint: user_give_emotion_NEG  
            
#### desde noemergency


## pos

## seguir conversación POS      
 
  - story: seguir conversación + Emotion 3 x POS contar
    steps:
      - intent: noemergency
      - action: utter_noemergency             # perdona, soy todo oídos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS         # fantastico!
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS2         # fantastico!
      - action: utter_ask_tell_more_POS     # quieres contarme algo mas? (selector)
      - intent: confirm                     # sí o directamente 
      - action: utter_si_contar             # soy todo oidos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_selector_POS_last     # quieres contarme algo mas o aprender emociones positivas?

  - story: seguir conversación POS + Emotion 3 x POS deny 
    steps:
      - intent: noemergency
      - action: utter_noemergency             # perdona, soy todo oídos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado # rasa 3 con la condicion slot = pos y ya sino lista de intents + pos
      - slot_was_set:
        - sentiment: POS                    # positivo
      - action: utter_sentiment_POS         # fantastico!
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
        - sentiment: POS                  # positivo
      - action: utter_sentiment_POS2         # fantastico!
      - action: utter_ask_tell_more_POS      # quieres contarme algo mas? (selector)
      - intent: deny                         # no
      - action: utter_no_contar 
      - action: utter_selector_POS_last      # quieres contarme algo mas o aprender emociones positivas?
    
### variaciones POS / NEU
  - story: seguir conversación POS + Emotion POS - POS - NEU contar
    steps:
      - intent: noemergency
      - action: utter_noemergency             # perdona, soy todo oídos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS         # fantastico!
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS2         # fantastico!
      - action: utter_ask_tell_more_POS     # quieres contarme algo mas? (selector)
      - intent: confirm                     # sí o directamente 
      - action: utter_si_contar             # soy todo oidos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado
      - slot_was_set:
          - sentiment: NEU                  # neutro
      - action: utter_selector_POS_last     # quieres contarme algo mas o aprender emociones positivas?

     
  - story: seguir conversación POS + Emotion POS - NEU - POS contar
    steps:
      - intent: noemergency
      - action: utter_noemergency             # perdona, soy todo oídos
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_sentiment_POS         # fantastico!
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado 
      - slot_was_set:
          - sentiment: NEU                  # neutro
      - action: utter_sentiment_NEU         # de acuerdo, me cuentas más?
      - or: 
        - intent: inform_sentiment
        - intent: nlu_fallback
        - intent: sobregeneralizacion
        - intent: etiquetado
      - slot_was_set:
          - sentiment: POS                  # positivo
      - action: utter_selector_POS_last     # quieres contarme algo mas o aprender emociones positivas?      
      
## seguir conversación NEG
  - story: seguir conversación NEG + 3 x NEG contar
    steps:
      - intent: noemergency
      - action: utter_noemergency             # perdona, soy todo oídos
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment       
      - slot_was_set:
          - sentiment: NEG                  # mal
      - action: utter_sentiment_NEG         # lo siento, cuéntame más
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_contar       # lo siento. quieres contarme más?
      - intent: confirmcontar               # sí 
      - action: utter_si_contar             # soy todo oídos
      - or:
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_NEG_last     # contar más o feedback emoción negativa?
      # - checkpoint: user_give_emotion_NEG

  - story: seguir conversación NEG + 3 x NEG deny
    steps:
      - intent: noemergency
      - action: utter_noemergency             # perdona, soy todo oídos
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment         
      - slot_was_set:
          - sentiment: NEG                  # mal
      - action: utter_sentiment_NEG         # lo siento, cuéntame más
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_contar       # lo siento. quieres contarme más?
      - intent: denyContar                  # no
      - action: utter_no_contar             # no pasa nada
      - action: utter_selector_NEG_last    # contar más o feedback emoción negativa?

## variaciones NEG / NEU

  - story: seguir conversación NEG + NEG - NEG - NEU contar
    steps:
      - intent: noemergency
      - action: utter_noemergency             # perdona, soy todo oídos
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment       
      - slot_was_set:
          - sentiment: NEG                  # mal
      - action: utter_sentiment_NEG         # lo siento, cuéntame más
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_contar       # lo siento. quieres contarme más?
      - intent: confirmcontar               # sí 
      - action: utter_si_contar             # soy todo oídos
      - or:
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEU                    # estoy mal
      - action: utter_selector_NEG_last     # contar más o feedback emoción negativa?
      # - checkpoint: user_give_emotion_NEG
      
  - story: seguir conversación NEG + NEG - NEU - NEG contar
    steps:
      - intent: noemergency
      - action: utter_noemergency             # perdona, soy todo oídos
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment       
      - slot_was_set:
          - sentiment: NEG                  # mal
      - action: utter_sentiment_NEG         # lo siento, cuéntame más
      - or: 
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEU                    # estoy mal
      - action: utter_sentiment_NEU         # soy todo oídos
      - or:
        - intent: nlu_fallback
        - intent: inform_sentiment
      - slot_was_set:
        - sentiment: NEG                    # estoy mal
      - action: utter_selector_NEG_last     # contar más o feedback emoción negativa?
      # - checkpoint: user_give_emotion_NEG  
            
